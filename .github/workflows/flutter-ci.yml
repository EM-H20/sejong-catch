name: ğŸš€ Flutter CI - ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬

# ğŸ¯ íŠ¸ë¦¬ê±° ì¡°ê±´: frontend, merge ë¸Œëœì¹˜ì—ì„œ ì½”ë“œ ë³€ê²½ ì‹œ
on:
  push:
    branches: [frontend, merge]
    paths:
      - 'sejong_catch-frontend/**'
      - '.github/workflows/flutter-ci.yml'
  pull_request:
    branches: [frontend, merge, main]
    paths:
      - 'sejong_catch-frontend/**'
      - '.github/workflows/flutter-ci.yml'

# ğŸ”§ í™˜ê²½ ë³€ìˆ˜
env:
  FLUTTER_VERSION: '3.24.0'  # ìµœì‹  stable ë²„ì „
  WORKING_DIRECTORY: ./sejong_catch-frontend

jobs:
  # ğŸ“Š ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ (like ê¹€ì¹˜ ë°œíš¨ë„ ì²´í¬!)
  code_quality:
    name: ğŸ“‹ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ${{ env.WORKING_DIRECTORY }}
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: âš¡ Flutter í™˜ê²½ ì„¤ì •
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true
          
      - name: ğŸ“¦ Flutter Doctor ì²´í¬
        run: flutter doctor -v
        
      - name: ğŸ” ì˜ì¡´ì„± ì„¤ì¹˜ (ì¹˜í‚¨ ì£¼ë¬¸í•˜ë“¯ ë¹ ë¥´ê²Œ!)
        run: flutter pub get
        
      - name: ğŸ§¹ ì½”ë“œ ë¶„ì„ (ê¹”ë”í•˜ê²Œ ì •ë¦¬!)
        run: |
          echo "ğŸ” ì½”ë“œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
          flutter analyze
          if [ $? -eq 0 ]; then
            echo "âœ… ì½”ë“œê°€ ê¹€ì¹˜ì²˜ëŸ¼ ì™„ë²½í•˜ê²Œ ë°œíš¨ëë„¤ìš”! ğŸ¥¬"
          else
            echo "âŒ ì•„ì´ê³ ... ì½”ë“œì— ë­”ê°€ ì´ìƒí•œ ëƒ„ìƒˆê°€? ğŸ¥²"
            exit 1
          fi
          
      - name: ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ë²„ê·¸ ì‚¬ëƒ¥ ì‹œì‘!)
        run: |
          echo "ğŸ§ª í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
          flutter test --coverage
          if [ $? -eq 0 ]; then
            echo "ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µ! ì´ì œ ì¹˜í‚¨ ì‹œì¼œë„ ë  ê²ƒ ê°™ë„¤ìš”! ğŸ—"
          else
            echo "ğŸ’¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨! ë””ë²„ê¹… íƒ€ì„ì´êµ°ìš”... â˜•"
            exit 1
          fi

  # ğŸ—ï¸ ë¹Œë“œ ê²€ì¦ (ë©€í‹° í”Œë«í¼)
  build_verification:
    name: ğŸ—ï¸ ë¹Œë“œ ê²€ì¦
    runs-on: ubuntu-latest
    needs: code_quality
    strategy:
      matrix:
        platform: [android, web]
    defaults:
      run:
        working-directory: ${{ env.WORKING_DIRECTORY }}
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        
      - name: âš¡ Flutter í™˜ê²½ ì„¤ì •
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true
          
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: flutter pub get
        
      # ğŸ¤– Android ë¹Œë“œ
      - name: ğŸ¤– Android APK ë¹Œë“œ
        if: matrix.platform == 'android'
        run: |
          echo "ğŸ¤– Android ë¹Œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
          flutter build apk --debug
          echo "âœ… Android APKê°€ ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œëì–´ìš”! ğŸ“±"
          
      # ğŸŒ Web ë¹Œë“œ  
      - name: ğŸŒ Web ë¹Œë“œ
        if: matrix.platform == 'web'
        run: |
          echo "ğŸŒ ì›¹ ë¹Œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
          flutter build web
          echo "âœ… ì›¹ ë¹Œë“œê°€ ì™„ë£Œëì–´ìš”! ë¸Œë¼ìš°ì €ì—ì„œ ë§Œë‚˜ìš”! ğŸ’»"
          
      # ğŸ“Š ë¹Œë“œ ê²°ê³¼ ì—…ë¡œë“œ (ì•„í‹°íŒ©íŠ¸)
      - name: ğŸ“Š ë¹Œë“œ ê²°ê³¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.platform }}-build-${{ github.sha }}
          path: |
            ${{ env.WORKING_DIRECTORY }}/build/app/outputs/flutter-apk/*.apk
            ${{ env.WORKING_DIRECTORY }}/build/web/
          retention-days: 5

  # ğŸ¯ ë¹Œë“œ ì„±ê³µ ì•Œë¦¼
  success_notification:
    name: ğŸ‰ ì„±ê³µ ì™„ë£Œ
    runs-on: ubuntu-latest
    needs: [code_quality, build_verification]
    if: success()
    
    steps:
      - name: ğŸŠ ì¶•í•˜ ë©”ì‹œì§€
        run: |
          echo "ğŸ‰ğŸ‰ğŸ‰ CI íŒŒì´í”„ë¼ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£ŒëìŠµë‹ˆë‹¤! ğŸ‰ğŸ‰ğŸ‰"
          echo "âœ¨ ì½”ë“œê°€ ì„¸ì¢…ëŒ€ ì •ë¬¸ë§Œí¼ ê¹”ë”í•´ì¡Œì–´ìš”!"
          echo "ğŸ— ì´ì œ ì¹˜í‚¨ í•œ ë§ˆë¦¬ ì‹œì¼œë„ ë  ê²ƒ ê°™ë„¤ìš”!"
          echo "ğŸš€ ë‹¤ìŒ ë‹¨ê³„ë¡œ ê³ ê³ ì”½!"